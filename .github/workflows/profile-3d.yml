name: GitHub-Profile-3D-Contrib

on:
  # 00:00 JST（= 15:00 UTC）に毎日実行
  schedule:
    - cron: "0 15 * * *"
  workflow_dispatch:   # 手動実行も可

jobs:
  build:
    runs-on: ubuntu-latest
    name: generate-github-profile-3d-contrib

    steps:
      # 1) 完全 clone（rebase のため履歴を全取得）
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true

      # 2) 3D Contrib 画像生成（最新バージョンを使用）
      - uses: yoshi389111/github-profile-3d-contrib@latest
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          USERNAME:      ${{ github.repository_owner }}
          SETTING_JSON:  conf/github-profile-3d-contrib.json

      # 3) 競合を避けてコミット & プッシュ
      - name: Commit & Push
        run: |
          git config user.name  github-actions
          git config user.email github-actions@github.com

          # リモート最新を取り込み、履歴を直列化
          git pull --rebase origin main

          # 差分が無ければ終了
          if git diff --quiet; then
            echo "Nothing to commit — skip push."
            exit 0
          fi

          git add -A .
          git commit -m "chore: update 3D contrib chart (auto)"
          git push
